
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Oracle TopLink, the ORA-00900 error and stored procedures - Radu Cotescu's professional blog</title>
  <meta name="author" content="Radu Cotescu">

  
  <meta name="description" content="Eliminate the chance of encountering the ORA-00900 error when working with TopLink and stored procedures.">
  <meta name="keywords" content="toplink, ora-00900, stored, procedures, procedure, database, query, read, modify">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://radu.cotescu.com/oracle-toplink-stored-procedures">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.cotescu.com/raducotescu" rel="alternate" title="Radu Cotescu's professional blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8815189-1']);
    _gaq.push(['_trackPageview']);
    _gaq.push(['_trackPageLoadTime']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div class="top-nav">
    <ul>
        <li><a href="/" title="Home">127.0.0.1</a></li>
        <li><a href="/about/" title="About">About</a></li>
        <li><a href="/privacy-policy/" title="Privacy Policy">Privacy Policy</a></li>
        <li><a href="/calendar/" title="Calendar">Calendar</a></li>
        <li><a href="/resume/" title="Resume">Resume</a></li>
    </ul>
  </div>
  <header role="banner"><hgroup>
  <h1><a href="/">Radu Cotescu's professional blog</a></h1>
  
    <h2>g33k w17h pa45510n</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="http://feeds.cotescu.com/raducotescu" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="http://feedburner.google.com/fb/a/mailverify?uri=raducotescu" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:radu.cotescu.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/category/-com">.com</a></li>
  <li><a href="/category/code">Code</a></li>
  <li><a href="/category/java">Java</a></li>
  <li><a href="/category/python">Python</a></li>
  <li><a href="/category/how-to">How To</a></li>
  <li><a href="/category/linux">Linux</a></li>
  <li><a href="/category/ubuntu">Ubuntu</a></li>
  <li><a href="/category/oracle">Oracle</a></li>
  <li><a href="/category/reviews">Reviews</a></li>
  <li><a href="/category/virtualization">Virtualization</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Oracle TopLink, the ORA-00900 Error and Stored Procedures</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-31T12:11:29+03:00" pubdate data-updated="true">May 31<span>st</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I was introduced to Oracle&#8217;s TopLink <a href="http://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a> package during my second internship at Oracle. Although the API (because TopLink actually became the reference implementation for the <a href="http://en.wikipedia.org/wiki/Java_Persistence_API">JPA</a> 2.0) seemed a bit overwhelming at first, I&#8217;ve managed to get a grasp of it quite fast, allowing me to finish the assigned projects in time. The familiarity with the API and with Toplink Workbench, a graphical tool designed to help you map database tables into Java classes (basically JavaBeans), made me use this combination for my diploma project (which I&#8217;ve been talking about more or less on my previous posts).</p>

<p>Working on a parser that would extract objects out of some very large text files (about 1.8 million lines) and would then persist them into a DB, I was required to eliminate duplicates. I had two options:</p>

<ol>
<li><p>parse the file, create an object, verify if the object was persisted by doing a SELECT query in the DB after its attributes (actually TopLink handled this part) and if the result was null persist the new object;</p></li>
<li><p>parse the file, create objects, persist them, eliminate duplicates after all objects have been parsed using a <em>stored procedure.</em></p></li>
</ol>


<p>While method 1 uses only the sequence values needed for the operation (I&#8217;m using sequences for my primary keys), for each INSERT a SELECT has to be made before, which would induce a performance fault. Method 2 on the other hand uses more sequence values than the first one by inserting more rows than actually needed, but even with this issue in mind it turned out to work faster. So there you go, we have a winner.</p>

<p>Using <em>stored procedures</em> has some advantages and as well some disadvantages. The advantages are that nothing is quicker than native database code and this option allows you to write complex operations using a simple implementation language (SQL, PL/SQL) which would be quite hard to write using programming languages. The disadvantages come in the application layer, because these stored procedures aren&#8217;t portable: if you change your database engine, let&#8217;s say from MySQL to Oracle, chances are that 99.5% you must rewrite those procedures.</p>

<p>In my case the stored procedure doesn&#8217;t return any rows, it actually deletes duplicates:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span>
</span><span class='line'><span class="k">PROCEDURE</span> <span class="n">procedure_name</span> <span class="k">AS</span>
</span><span class='line'><span class="k">BEGIN</span>
</span><span class='line'>  <span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span> <span class="n">a</span> <span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="p">(</span>
</span><span class='line'>  <span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">FROM</span> <span class="k">table_name</span> <span class="n">b</span>
</span><span class='line'>  <span class="k">WHERE</span>
</span><span class='line'>    <span class="n">b</span><span class="p">.</span><span class="n">field1</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">field1</span> <span class="k">AND</span>
</span><span class='line'>    <span class="n">b</span><span class="p">.</span><span class="n">field2</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">field2</span> <span class="k">AND</span>
</span><span class='line'>    <span class="n">b</span><span class="p">.</span><span class="n">field3</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">field3</span>
</span><span class='line'>  <span class="p">);</span>
</span><span class='line'><span class="k">END</span> <span class="n">procedure_name</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Java code used for calling this procedure is simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">deleteDuplicates</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">ToplinkSession</span><span class="o">.</span><span class="na">getToplinkSession</span><span class="o">();</span>
</span><span class='line'>    <span class="n">DataModifyQuery</span> <span class="n">dmq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataModifyQuery</span><span class="o">();</span>
</span><span class='line'>    <span class="n">StoredProcedureCall</span> <span class="n">spc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StoredProcedureCall</span><span class="o">();</span>
</span><span class='line'>    <span class="n">spc</span><span class="o">.</span><span class="na">setProcedureName</span><span class="o">(</span><span class="s">&quot;procedure_name&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">dmq</span><span class="o">.</span><span class="na">setCall</span><span class="o">(</span><span class="n">spc</span><span class="o">);</span>
</span><span class='line'>    <span class="n">session</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">dmq</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>where ToplinkSession is a singleton class with a static method for returning a <code>Session</code> (or <code>DatabaseSession</code>) object. Note the highlighted line: if you would use a <code>ReadAllQuery</code> instead of <code>DataModifyQuery</code> you&#8217;d get a <code>java.sql.SQLException</code> nested in an <code>oracle.toplink.DatabaseException</code> together with an <strong>ORA-00900</strong> error message, even if the generated SQL doesn&#8217;t contain errors. This is because the <code>ReadAllQuery</code> expects data to return, while the other doesn&#8217;t. So the correct way of calling stored procedures that don&#8217;t return data is with the help of <code>DataModifyQuery</code>.</p>

<p>I hope that by having all this cleared out you won&#8217;t deal with this error any more.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Radu Cotescu</span></span>

      








  


<time datetime="2010-05-31T12:11:29+03:00" pubdate data-updated="true">May 31<span>st</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/category/code/'>Code</a>, <a class='category' href='/category/how-to/'>How To</a>, <a class='category' href='/category/java/'>Java</a>, <a class='category' href='/category/oracle/'>Oracle</a>
  
</span>


    </p>
    
      <div class="sharing">
  
    <script type="text/javascript" src="http://www.reddit.com/static/button/button3.js"></script>
  
  
  	<a href="http://twitter.com/share" class="twitter-share-button" data-url="http://radu.cotescu.com/oracle-toplink-stored-procedures/" data-via="raducotescu" data-counturl="http://radu.cotescu.com/oracle-toplink-stored-procedures/" >Tweet</a>
  	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  
  
  	<div class="g-plusone" data-size="medium"></div>
  	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  
    <div class="fb-like" data-send="true" data-width="350" data-show-faces="false"></div>
    
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/virtualbox-virtual-servers/" title="Previous Post: Using VirtualBox for virtualizing servers">&laquo; Using VirtualBox for virtualizing servers</a>
      
      
        <a class="basic-alignment right" href="/javascript-diff-function/" title="Next Post: A very simple JavaScript diff function">A very simple JavaScript diff function &raquo;</a>
      
    </p>
  </footer>
</article>

  <section style="margin-bottom: 30px">
    <div id="google-ads-comments" style="margin: 0 auto auto; text-align: center">
      <script type="text/javascript"><!--
        google_ad_client = "ca-pub-8659561010253809";
        /* NearCommentsBox468x60 */
        google_ad_slot = "0858986716";
        google_ad_width = 468;
        google_ad_height = 60;
      //-->
      </script>
      <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
    </div>
  </section>
  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    

<script type="text/javascript">
      var disqus_shortname = 'raducotescu';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://radu.cotescu.com/oracle-toplink-stored-procedures/';
        var disqus_url = 'http://radu.cotescu.com/oracle-toplink-stored-procedures/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/coloured-log-outputs/">Coloured log outputs on Unix/Linux</a>
      </li>
    
      <li class="post">
        <a href="/java-common-sense/">A useful rant on how people write Java code</a>
      </li>
    
      <li class="post">
        <a href="/tools-required-for-opening-a-macbook-pro/">Tools required for opening a MacBook Pro</a>
      </li>
    
      <li class="post">
        <a href="/the-switch-to-mac-from-ubuntu/">Switching to Mac from Ubuntu</a>
      </li>
    
      <li class="post">
        <a href="/migrating-your-ubuntu-machine-to-a-ssd-drive/">Migrating your Ubuntu machine to a SSD drive</a>
      </li>
    
  </ul>
</section>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8659561010253809";
/* Sidebar250x250 */
google_ad_slot = "8430472643";
google_ad_width = 250;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

<section>
  <h1>Latest Tweets</h1>
    <script charset="utf-8" src="http://widgets.twimg.com/j/2/widget.js"></script>
    <script>
    new TWTR.Widget({
      version: 2,
      type: 'profile',
      rpp: 5,
      interval: 30000,
      width: 250,
      height: 370,
      theme: {
        shell: {
          background: '#cfcfcf',
          color: '#ffffff'
        },
        tweets: {
          background: '#e8e8e8',
          color: '#4b4b4b',
          links: '#0182eb'
        }
      },
      features: {
        scrollbar: false,
        loop: false,
        live: true,
        behavior: 'all'
      }
    }).render().setUser('raducotescu').start();
    </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/106725941266744510645?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  &copy; 2009 - 2012 - Radu Cotescu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


</body>
</html>
