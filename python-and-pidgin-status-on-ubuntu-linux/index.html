<hr />

<p>date: &#8216;2009-08-26 18:01:43&#8217;
layout: post
slug: python-and-pidgin-status-on-ubuntu-linux
status: publish
description: &#8220;This post will show you how you can use Python to change your Pidgin&#8217;s status with your blog&#8217;s post titles taken from your feed.&#8221;
title: Python and Pidgin&#8217;s status on Ubuntu (Linux)
comments: true
wordpress_id: &#8216;801&#8217;
categories:
- .com
- Code
- How To
- Linux
- Python</p>

<h2>- Ubuntu</h2>

<p><a href="http://motane.lu">Tudor</a> has found a <a href="http://blog.motane.lu/2009/08/21/advertising-blog-entries-on-pidgins-status/">better solution</a> to advertise one&#8217;s blog posts with the help of Pidgin and a little bit of Python. I did argue with him a bit regarding the number of requests made (you can see that in the comments on his blog post) but finally I would agree that his solution was better than mine, only that I felt the need to improve it a bit. This still needs to set DBUS session parameters at log in time, and thanks to <a href="http://earlruby.org">Earl Ruby</a> this can be done easily too.</p>

<p>The script is pretty simple and I made it write a log to <code>stdout</code>, which with the help of <code>cron</code> can be piped to any file you want. Knock yourself out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python                                                       </span>
</span><span class='line'><span class="c"># pidgin_status_change.py                                               </span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;                                                                     </span>
</span><span class='line'><span class="sd">Handy script for changing Pidgin&#39;s status with a post from a feed passed as argument.</span>
</span><span class='line'><span class="sd">Usage:                                                                               </span>
</span><span class='line'><span class="sd">        python pidgin_status_change.py your_feed_link                                </span>
</span><span class='line'>
</span><span class='line'><span class="sd">Authors:</span>
</span><span class='line'><span class="sd">        Tudor Barbu,    http://motane.lu</span>
</span><span class='line'><span class="sd">        Radu Cotescu,   http://radu.cotescu.com</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">commands</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">feedparser</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">random</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="c"># feed url</span>
</span><span class='line'><span class="n">FEED</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">setFeed</span><span class="p">():</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span class='line'>                <span class="k">global</span> <span class="n">FEED</span>
</span><span class='line'>                <span class="n">FEED</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">changeStatus</span><span class="p">():</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">FEED</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">commands</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="s">&#39;pidof pidgin&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">feed</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="n">FEED</span> <span class="p">)</span>
</span><span class='line'>                        <span class="n">index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span> <span class="n">feed</span><span class="p">[</span><span class="s">&#39;items&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
</span><span class='line'>                        <span class="k">print</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">-%m-%Y, %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
</span><span class='line'>                        <span class="k">print</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\t</span><span class="s">Status:</span><span class="se">\n\t</span><span class="si">%s</span><span class="se">\n\t</span><span class="si">%s</span><span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">feed</span><span class="p">[</span><span class="s">&#39;items&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">feed</span><span class="p">[</span><span class="s">&#39;items&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>                        <span class="n">status</span> <span class="o">=</span> <span class="s">&#39;purple-remote &quot;setstatus?status=available&amp;message=</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">feed</span><span class="p">[</span><span class="s">&#39;items&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">feed</span><span class="p">[</span><span class="s">&#39;items&#39;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">link</span> <span class="p">)</span>
</span><span class='line'>                        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="n">setFeed</span><span class="p">()</span>
</span><span class='line'><span class="n">changeStatus</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c"># EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Setting your DBUS session parameters requires exporting some variables to your environment. Take the script below and add it via <em>System - Preferences - Startup Applications</em> to the list of programs that start at log in. This way you&#8217;ll always be sure the needed variables are available.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#Export the dbus session address on startup so it can be used by cron</span>
</span><span class='line'>touch <span class="nv">$HOME</span>/.Xdbus
</span><span class='line'>chmod 600 <span class="nv">$HOME</span>/.Xdbus
</span><span class='line'>env | grep DBUS_SESSION_BUS_ADDRESS &gt; <span class="nv">$HOME</span>/.Xdbus
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;export DBUS_SESSION_BUS_ADDRESS&#39;</span> &gt;&gt; <span class="nv">$HOME</span>/.Xdbus
</span><span class='line'><span class="c"># Export XAUTHORITY value on startup so it can be used by cron</span>
</span><span class='line'>env | grep XAUTHORITY &gt;&gt; <span class="nv">$HOME</span>/.Xdbus
</span><span class='line'><span class="nb">echo</span> <span class="s1">&#39;export XAUTHORITY&#39;</span> &gt;&gt; <span class="nv">$HOME</span>/.Xdbus
</span></code></pre></td></tr></table></div></figure>


<p>Then you only need to set <code>cron</code> to do the job:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">SHELL</span><span class="o">=</span>/bin/bash
</span><span class='line'><span class="nv">DISPLAY</span><span class="o">=</span>:0.0
</span><span class='line'>*/5 * * * * <span class="nb">source</span> ~/.Xdbus; /home/radu/scripts/pidgin_python/pidgin_status_change.py http://feeds2.feedburner.com/raducotescu &gt;&gt; /home/radu/crontab.log
</span></code></pre></td></tr></table></div></figure>


<p>You can download everything from <a href="https://github.com/raducotescu/pidgin-status-scripts/tarball/master">here</a>.</p>

<p>Happy blogging!</p>
